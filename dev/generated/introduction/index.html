<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Introduction to VIDA · VIDA.jl</title><meta name="title" content="Introduction to VIDA · VIDA.jl"/><meta property="og:title" content="Introduction to VIDA · VIDA.jl"/><meta property="twitter:title" content="Introduction to VIDA · VIDA.jl"/><meta name="description" content="Documentation for VIDA.jl."/><meta property="og:description" content="Documentation for VIDA.jl."/><meta property="twitter:description" content="Documentation for VIDA.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">VIDA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><a class="tocitem" href="../../interface/">Interfaces</a></li><li class="is-active"><a class="tocitem" href>Introduction to VIDA</a><ul class="internal"><li><a class="tocitem" href="#Getting-started"><span>Getting started</span></a></li><li><a class="tocitem" href="#Extracting-the-Optimal-Template"><span>Extracting the Optimal Template</span></a></li></ul></li><li><a class="tocitem" href="../custom_template/">Adding a Custom Template</a></li><li><a class="tocitem" href="../../api/function_index/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Introduction to VIDA</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Introduction to VIDA</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ptiede/VIDA.jl/blob/master/example/introduction.jl#L" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Introduction-to-VIDA"><a class="docs-heading-anchor" href="#Introduction-to-VIDA">Introduction to VIDA</a><a id="Introduction-to-VIDA-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction-to-VIDA" title="Permalink"></a></h1><p>Using VIDA is based on constructing three items:</p><ol><li>Data, i.e. an image that you want to extract features from.</li><li>Cost function, i.e. pick if you want to use the KL or BH divergence</li><li>Template, i.e. construct the family of distributions or templates that you will use to approximate the image.</li></ol><p>Then all you need to do is minimize the divergence and you will have extracted you image features.</p><p>Now lets runs through how that works</p><h2 id="Getting-started"><a class="docs-heading-anchor" href="#Getting-started">Getting started</a><a id="Getting-started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-started" title="Permalink"></a></h2><p>To load VIDA we follow the typical Julia flow. Note that to include plotting functionality you need to include Plots as well</p><pre><code class="language-julia hljs">using VIDA



using CairoMakie
using InteractiveUtils</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  Activating project at `~/work/VIDA.jl/VIDA.jl/example`</code></pre><h3 id="Step-1-Read-in-Data"><a class="docs-heading-anchor" href="#Step-1-Read-in-Data">Step 1 Read in Data</a><a id="Step-1-Read-in-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Step-1-Read-in-Data" title="Permalink"></a></h3><p><code>VIDA</code> currently only works with fits images. The fits header is based off of what <a href="https://github.com/achael/eht-imaging">eht-imaging</a> outputs. So as long as you stick to that standard you should be fine.</p><p>To read in an image we just use the <a href="../../api/function_index/#VIDA.load_image-Tuple{Any}"><code>VIDA.load_image</code></a> function which should work with any fits image from ehtim and clean</p><pre><code class="language-julia hljs">img = load_image(joinpath(dirname(pathof(VIDA)), &quot;../example/data/example_image.fits&quot;));</code></pre><p>To see what this img is lets print the type</p><pre><code class="language-julia hljs">println(typeof(img))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SpatialIntensityMap{Float64, RectiGrid{Tuple{X{DimensionalData.Dimensions.Lookups.Sampled{Float64, LinRange{Float64, Int64}, DimensionalData.Dimensions.Lookups.ForwardOrdered, DimensionalData.Dimensions.Lookups.Regular{Float64}, DimensionalData.Dimensions.Lookups.Points, DimensionalData.Dimensions.Lookups.NoMetadata}}, Y{DimensionalData.Dimensions.Lookups.Sampled{Float64, LinRange{Float64, Int64}, DimensionalData.Dimensions.Lookups.ForwardOrdered, DimensionalData.Dimensions.Lookups.Regular{Float64}, DimensionalData.Dimensions.Lookups.Points, DimensionalData.Dimensions.Lookups.NoMetadata}}}, Serial, ComradeBase.MinimalHeader{Float64}, Float64}, Matrix{Float64}, Tuple{X{DimensionalData.Dimensions.Lookups.Sampled{Float64, LinRange{Float64, Int64}, DimensionalData.Dimensions.Lookups.ForwardOrdered, DimensionalData.Dimensions.Lookups.Regular{Float64}, DimensionalData.Dimensions.Lookups.Points, DimensionalData.Dimensions.Lookups.NoMetadata}}, Y{DimensionalData.Dimensions.Lookups.Sampled{Float64, LinRange{Float64, Int64}, DimensionalData.Dimensions.Lookups.ForwardOrdered, DimensionalData.Dimensions.Lookups.Regular{Float64}, DimensionalData.Dimensions.Lookups.Points, DimensionalData.Dimensions.Lookups.NoMetadata}}}, Tuple{}, Symbol}</code></pre><p>To plot the image we use the <code>VLBISkyModels.imageviz</code> function.</p><pre><code class="language-julia hljs">imageviz(img)</code></pre><img src="214ce54b.png" alt="Example block output"/><p>So from the output we see that img is a <code>IntensityMap</code> type. This follows ComradeBase and VLBISkyModels, see their <a href="https://ehtjulia.github.io/VLBISkyModels.jl/stable/">docs</a> for more information.</p><p>Julia isn&#39;t a traditional class OOP language. Namely, methods/functions are first class and aren&#39;t members of a class. Instead how a function behaves is dependent on the type of argument inputs. This is known as something called multimethods or <em>multiple dispatch</em> where at run-time the type of functions called is determined by the arguments.</p><p>In some sense OOP is just a multiple dispatch type language where the our type of dispatch only depends on the class, i.e. the self argument in Python classes.</p><p>Now because of the lack of classes sometimes it can be difficult to figure out which functions will act of our datatypes, e.g. the <code>IntensityMap</code> type. Fortunately, Julia has some convenience functions that let you see which functions/methods can act of the <code>IntensityMap</code> type</p><pre><code class="language-julia hljs">methodswith(IntensityMap)


# Creating a divergence</code></pre>39-element Vector{Method}:<ul><li> getproperty(img::<b>IntensityMap</b>, p::<b>Symbol</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:98</a><li> parent(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:162</a><li> propertynames(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:94</a><li> dims(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:61</a><li> metadata(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:65</a><li> name(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:64</a><li> rebuild(img::<b>IntensityMap</b>, data, dims::<b>Tuple</b>, refdims, n) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:166</a><li> rebuild(img::<b>IntensityMap</b>, data, dims::<b>Tuple</b>, refdims) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:166</a><li> rebuild(img::<b>IntensityMap</b>, data, dims::<b>Tuple</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:166</a><li> rebuild(img::<b>IntensityMap</b>, data) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:166</a><li> rebuild(img::<b>IntensityMap</b>, data, dims::<b>Tuple</b>, refdims, n, metadata) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:166</a><li> rebuild(img::<b>IntensityMap</b>; <i>data, dims, refdims, name, metadata</i>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:181</a><li> refdims(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:62</a><li> IntensityMap(data::<b>IntensityMap</b>, g::<b>ComradeBase.AbstractRectiGrid</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:136</a><li> axisdims(img::<b>IntensityMap</b>, p::<b>Symbol</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:149</a><li> axisdims(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:148</a><li> baseimage(x::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:164</a><li> domainpoints(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/methods.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/methods.jl:8</a><li> executor(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:66</a><li> fieldofview(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/methods.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/methods.jl:110</a><li> flux(im::<b>IntensityMap{T, N, D, G, A} where {D, G<:(ComradeBase.AbstractRectiGrid{D}), A<:AbstractArray{T, N}}</b>)<i> where {T, N}</i> in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/methods.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/methods.jl:121</a><li> header(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:158</a><li> intensitymap!(img::<b>IntensityMap</b>, m::<b>InterpolatedModel</b>) in VLBISkyModels at <a href="file:///home/runner/.julia/packages/VLBISkyModels/cMgqK/src/models/interpolated.jl" target="_blank">/home/runner/.julia/packages/VLBISkyModels/cMgqK/src/models/interpolated.jl:66</a><li> named_dims(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/dim_image.jl:151</a><li> phasecenter(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/methods.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/methods.jl:62</a><li> pixelsizes(img::<b>IntensityMap</b>) in ComradeBase at <a href="file:///home/runner/.julia/packages/ComradeBase/fQVUc/src/images/methods.jl" target="_blank">/home/runner/.julia/packages/ComradeBase/fQVUc/src/images/methods.jl:114</a><li> ContinuousImage(img::<b>IntensityMap</b>, pulse::<b>VLBISkyModels.Pulse</b>) in VLBISkyModels at <a href="file:///home/runner/.julia/packages/VLBISkyModels/cMgqK/src/models/continuous_image.jl" target="_blank">/home/runner/.julia/packages/VLBISkyModels/cMgqK/src/models/continuous_image.jl:60</a><li> ContinuousImage(img::<b>A</b>, kernel::<b>P</b>)<i> where {A<:IntensityMap, P}</i> in VLBISkyModels at <a href="file:///home/runner/.julia/packages/VLBISkyModels/cMgqK/src/models/continuous_image.jl" target="_blank">/home/runner/.julia/packages/VLBISkyModels/cMgqK/src/models/continuous_image.jl:17</a><li> PoincareSphere2Map(I::<b>IntensityMap</b>, p, X) in VLBISkyModels at <a href="file:///home/runner/.julia/packages/VLBISkyModels/cMgqK/src/models/polarized.jl" target="_blank">/home/runner/.julia/packages/VLBISkyModels/cMgqK/src/models/polarized.jl:300</a><li> imageviz(img::<b>IntensityMap</b>; <i>scale_length, backgroundcolor, kwargs...</i>) in VLBISkyModelsMakieExt at <a href="file:///home/runner/.julia/packages/VLBISkyModels/cMgqK/ext/VLBISkyModelsMakieExt.jl" target="_blank">/home/runner/.julia/packages/VLBISkyModels/cMgqK/ext/VLBISkyModelsMakieExt.jl:364</a><li> modify(img::<b>IntensityMap</b>, transforms...) in VLBISkyModels at <a href="file:///home/runner/.julia/packages/VLBISkyModels/cMgqK/src/utility.jl" target="_blank">/home/runner/.julia/packages/VLBISkyModels/cMgqK/src/utility.jl:72</a><li> regrid(img::<b>IntensityMap</b>, g::<b>RectiGrid</b>) in VLBISkyModels at <a href="file:///home/runner/.julia/packages/VLBISkyModels/cMgqK/src/utility.jl" target="_blank">/home/runner/.julia/packages/VLBISkyModels/cMgqK/src/utility.jl:178</a><li> save_fits(fname::<b>String</b>, img::<b>IntensityMap</b>) in VLBISkyModels at <a href="file:///home/runner/.julia/packages/VLBISkyModels/cMgqK/src/io.jl" target="_blank">/home/runner/.julia/packages/VLBISkyModels/cMgqK/src/io.jl:132</a><li> smooth(img::<b>IntensityMap</b>, σ::<b>Number</b>) in VLBISkyModels at <a href="file:///home/runner/.julia/packages/VLBISkyModels/cMgqK/src/utility.jl" target="_blank">/home/runner/.julia/packages/VLBISkyModels/cMgqK/src/utility.jl:154</a><li> stokes_intensitymap(I::<b>IntensityMap</b>, Q::<b>IntensityMap</b>, U::<b>IntensityMap</b>, V::<b>IntensityMap</b>) in VLBISkyModels at <a href="file:///home/runner/.julia/packages/VLBISkyModels/cMgqK/src/models/polarized.jl" target="_blank">/home/runner/.julia/packages/VLBISkyModels/cMgqK/src/models/polarized.jl:17</a><li> Bhattacharyya(img::<b>T</b>)<i> where T<:IntensityMap</i> in VIDA at <a href="https://github.com/ptiede/VIDA.jl/tree/d0e728dfc1966338dcb9ef27fb5d0b0929af49ab//src/divergences.jl#L135" target="_blank">/home/runner/work/VIDA.jl/VIDA.jl/src/divergences.jl:135</a><li> KullbackLeibler(img::<b>IntensityMap</b>) in VIDA at <a href="https://github.com/ptiede/VIDA.jl/tree/d0e728dfc1966338dcb9ef27fb5d0b0929af49ab//src/divergences.jl#L165" target="_blank">/home/runner/work/VIDA.jl/VIDA.jl/src/divergences.jl:165</a><li> NxCorr(img::<b>T</b>)<i> where T<:IntensityMap</i> in VIDA at <a href="https://github.com/ptiede/VIDA.jl/tree/d0e728dfc1966338dcb9ef27fb5d0b0929af49ab//src/divergences.jl#L254" target="_blank">/home/runner/work/VIDA.jl/VIDA.jl/src/divergences.jl:254</a><li> Renyi(img::<b>T</b>, α)<i> where T<:IntensityMap</i> in VIDA at <a href="https://github.com/ptiede/VIDA.jl/tree/d0e728dfc1966338dcb9ef27fb5d0b0929af49ab//src/divergences.jl#L200" target="_blank">/home/runner/work/VIDA.jl/VIDA.jl/src/divergences.jl:200</a></ul><p>In order to find the optimal template you need to first decide on your objective or cost function. In VIDA we use probaility divergences to measure differences between the template and image. A divergence is defined as an abstract type <a href="../../api/function_index/#VIDA.AbstractDivergence"><code>VIDA.AbstractDivergence</code></a>.</p><pre><code class="language-julia hljs">bh = Bhattacharyya(img);
kl = KullbackLeibler(img);</code></pre><p>Now to evaluate the divergence we need a template to compare the image to. For instance lets create a few different templates</p><pre><code class="language-julia hljs">gr = GaussianRing(μas2rad(20.0), μas2rad(5.0), 0.0, 0.0)
ggr = EllipticalSlashedGaussianRing(
    μas2rad(20.0), # r0
    μas2rad(5.0), # σ
    0.2, # τ
    0.78, # ξτ
    0.5, # s
    0.78, # ξs
    μas2rad(-10.0), # x0
    0.0 # y0
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ModifiedModel
  base model: RingTemplate{RadialGaussian{Float64}, AzimuthalCosine{1, Float64, Float64}}(RadialGaussian{Float64}(0.25), AzimuthalCosine{1, Float64, Float64}((0.5,), (0.0,)))
  Modifiers:
    1. Rotate{Float64}
    2. Stretch{Float64, Float64, Float64}
    3. Rotate{Float64}
    4. Shift{Float64, Float64, Float64}</code></pre><p>We can also plot both templates</p><pre><code class="language-julia hljs">g = imagepixels(μas2rad(128.0), μas2rad(128.0), 128, 128)
fig = Figure(; size = (600, 300))
axis = axis = (aspect = 1, xticklabelsvisible = false, yticklabelsvisible = false)
image(fig[1, 1], intensitymap(gr, g), colormap = :afmhot, axis = merge(axis, (title = &quot;GaussianRing&quot;,)))
image(fig[1, 2], intensitymap(ggr, g), colormap = :afmhot, axis = merge(axis, (title = &quot;GeneralGaussianRing&quot;,)))
fig</code></pre><img src="a3e6e8d9.png" alt="Example block output"/><p>VIDA has a number of templates defined. These are all subtypes of the <a href="@ref"><code>AbstractTemplate</code></a> type. To see which templates are implemented you can use the subtype method:</p><pre><code class="language-julia hljs">subtypes(VLBISkyModels.AbstractImageTemplate)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Any}:
 CosineRing
 RingTemplate
 VLBISkyModels.Constant
 VLBISkyModels.GaussDisk
 VLBISkyModels.LogSpiral</code></pre><p>Additionally as of VIDA 0.11 we can also use any VLBISkyModels model and any model that satisfies the interface described <a href="https://ehtjulia.github.io/VLBISkyModels.jl/dev/interface/#Model-Interface">here</a>.</p><p>Using VLBISkyModels interface we can also combine templates together</p><pre><code class="language-julia hljs">add = gr + 2.0 * shifted(gr, μas2rad(-10.0), μas2rad(10.0))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">VLBISkyModels.AddModel(
model1: ModifiedModel
  base model: RingTemplate{RadialGaussian{Float64}, AzimuthalUniform{Float64}}(RadialGaussian{Float64}(0.25), AzimuthalUniform{Float64}())
  Modifiers:
    1. Stretch{Float64, Float64, Float64}
    2. Shift{Float64, Float64, Float64}
model2: ModifiedModel
  base model: RingTemplate{RadialGaussian{Float64}, AzimuthalUniform{Float64}}(RadialGaussian{Float64}(0.25), AzimuthalUniform{Float64}())
  Modifiers:
    1. Stretch{Float64, Float64, Float64}
    2. Shift{Float64, Float64, Float64}
    3. Shift{Float64, Float64, Float64}
    4. Renormalize{Float64}
)</code></pre><p>To evaluate the divergence between our template and image we then just evaluate the <a href="../../api/function_index/#VIDA.divergence-Tuple{VIDA.AbstractDivergence, ComradeBase.AbstractModel}"><code>VIDA.divergence</code></a> on the template</p><pre><code class="language-julia hljs">@show divergence(kl, add);
@show divergence(kl, ggr);
@show divergence(kl, add);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">divergence(kl, add) = 1.3524191660571612
divergence(kl, ggr) = 0.7758112802401305
divergence(kl, add) = 1.3524191660571612</code></pre><p>Now neither template is really a great approximation to the true image. For instance visually they look quite different, which can be checked with the <a href="../../api/function_index/#VIDA.triptic"><code>VIDA.triptic</code></a> function</p><pre><code class="language- hljs">figa, ax = triptic(img, gr)
figa</code></pre><pre><code class="language- hljs">figb, ax = triptic(img, ggr)
figb</code></pre><pre><code class="language- hljs">figc, ax = triptic(img, add)
figc</code></pre><h2 id="Extracting-the-Optimal-Template"><a class="docs-heading-anchor" href="#Extracting-the-Optimal-Template">Extracting the Optimal Template</a><a id="Extracting-the-Optimal-Template-1"></a><a class="docs-heading-anchor-permalink" href="#Extracting-the-Optimal-Template" title="Permalink"></a></h2><p>To extract the optimal template the first thing you need to do is define your a function that construct the template and parameterization you will consider</p><pre><code class="language-julia hljs">function gr_temp(θ)
    return GaussianRing(θ.r0, θ.σ, θ.x0, θ.y0)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">gr_temp (generic function with 1 method)</code></pre><p>We also want to select the domain that we want to search over</p><pre><code class="language-julia hljs">lower = map(μas2rad, (r0 = 5.0, σ = 0.01, x0 = -60.0, y0 = -60.0))
upper = map(μas2rad, (r0 = 60.0, σ = 20.0, x0 = 60.0, y0 = 60.0))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(r0 = 2.908882086657216e-10, σ = 9.69627362219072e-11, x0 = 2.908882086657216e-10, y0 = 2.908882086657216e-10)</code></pre><p>Given that we can form the <a href="../../api/function_index/#VIDA.VIDAProblem"><code>VIDA.VIDAProblem</code></a> type.</p><pre><code class="language-julia hljs">prob = VIDAProblem(bh, gr_temp, lower, upper);</code></pre><p>Now we need to optimize. VIDA uses the <a href="https://github.com/SciML/Optimization.jl">Optimization.jl</a> meta package for optimization. That means that we can use any optimization package that works with optimization. For information about possible optimizers see their <a href="https://docs.sciml.ai/Optimization/stable/">docs</a>.</p><p>For VIDA the classic optimizer is using the <a href="https://github.com/robertfeldt/BlackBoxOptim.jl">BlackBoxOptim.jl</a>. To use BlackBox optim we need to load the required package</p><pre><code class="language-julia hljs">using OptimizationBBO</code></pre><p>However, for this tutorial we will use the <code>BlackBoxOptim</code> optimizer.</p><p>To optimize all you need to do is run the <a href="../../api/function_index/#VIDA.vida"><code>VIDA.vida</code></a> function.</p><pre><code class="language- hljs">xopt, optfilt, divmin = vida(prob, BBO_de_rand_1_bin_radiuslimited(); maxiters = 100_000)
fig, ax = triptic(img, optfilt)
fig</code></pre><p>Well that seemed to do a terrible job. The reason is that a lot of these images tend to have some low level flux throughout the image. To account for this the template tends to get very big to absorb some of this flux. To combat this you can add a constant background template to the problem.</p><pre><code class="language-julia hljs">gr_temp_cont(θ) = GaussianRing(θ.r0, θ.σ, θ.x0, θ.y0) + θ.f * VLBISkyModels.Constant((μas2rad(100.0)))
lower = (r0 = μas2rad(5.0), σ = μas2rad(0.01), x0 = μas2rad(-60.0), y0 = μas2rad(-60.0), f = 1.0e-6)
upper = (r0 = μas2rad(60.0), σ = μas2rad(20.0), x0 = μas2rad(60.0), y0 = μas2rad(60.0), f = 10.0)
prob = VIDAProblem(bh, gr_temp_cont, lower, upper);
xopt, optfilt, divmin = vida(prob, BBO_de_rand_1_bin_radiuslimited(); maxiters = 50_000)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">((r0 = 9.070140709499926e-11, σ = 1.701111803566815e-11, x0 = -2.8522006521932255e-11, y0 = -1.3395571133065426e-11, f = 0.09672590121696419), VLBISkyModels.AddModel(
model1: ModifiedModel
  base model: RingTemplate{RadialGaussian{Float64}, AzimuthalUniform{Float64}}(RadialGaussian{Float64}(0.18755076222633424), AzimuthalUniform{Float64}())
  Modifiers:
    1. Stretch{Float64, Float64, Float64}
    2. Shift{Float64, Float64, Float64}
model2: ModifiedModel
  base model: VLBISkyModels.Constant{Float64}(4.84813681109536e-10)
  Modifiers:
    1. Renormalize{Float64}
), 0.05546046132335986)</code></pre><pre><code class="language- hljs">fig, ax = triptic(img, optfilt)
fig</code></pre><p>That&#39;s much better! Now if you wanted to capture the asymmetry in the ring you can use other templates, for example the CosineRing template. Note that this template tends to be a little harder to fit.</p><pre><code class="language-julia hljs">cos_temp(θ) = EllipticalSlashedGaussianRing(θ.r0, θ.σ, θ.τ, θ.ξτ, θ.s, θ.ξs, θ.x0, θ.y0) + θ.f * θ.f * VLBISkyModels.Constant(μas2rad(100.0))
lower = (r0 = μas2rad(1.0), σ = μas2rad(0.01), τ = 0.0, ξτ = -π / 2, s = 0.001, ξs = -1π, x0 = μas2rad(-60.0), y0 = μas2rad(-60.0), f = 1.0e-6)
upper = (r0 = μas2rad(60.0), σ = μas2rad(20.0), τ = 0.5, ξτ = π / 2, s = 0.999, ξs = 1π, x0 = μas2rad(60.0), y0 = μas2rad(60.0), f = 10.0)
prob = VIDAProblem(bh, cos_temp, lower, upper);
xopt, optfilt, divmin = vida(prob, BBO_de_rand_1_bin_radiuslimited(); maxiters = 50_000);</code></pre><pre><code class="language- hljs">fig, ax = triptic(img, optfilt)
fig</code></pre><p>Now looks pretty great! To see how to add a custom template see the <a href="../custom_template/#Adding-a-Custom-Template">Adding a Custom Template</a> page.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../interface/">« Interfaces</a><a class="docs-footer-nextpage" href="../custom_template/">Adding a Custom Template »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 21 July 2025 18:39">Monday 21 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
